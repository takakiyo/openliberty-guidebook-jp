## Open Libertyとは

Open Liberty（https://openliberty.io）とは，IBMによって開発されているオープンソースのエンタープライズJavaランタイムです。軽量で高速に動作し，構成も容易で簡単に利用を開始することができます。

MicroProfile仕様に対応しており，高速かつ効率的なクラウドネイティブJavaマイクロサービスを構築することができます。また，Java EE，Jakarta EEにも対応しており，従来型のエンタープライズJavaアプリケーションをモダナイズするプラットフォームとしても利用できます。Spring Bootアプリケーションにも対応しており，高い負荷にも耐える高速なランタイムとして利用可能です。

EPL（Eclipse Public License）で公開されており，だれでも無料で自由に利用することが可能です。本番業務を実行する実働環境にも無償で利用できます。またOpen Libertyを実行環境として組み込んだ製品の販売も自由に行えます。

IBMでは，1998年からWebSphere Application Server（WAS）というJava EEに準拠したアプリケーションサーバーを提供してきました。従来型のWASはモノリシックな実装であったため，実装されている機能の全てが常に有効になっています。長年のバージョンアップによって多くの機能が追加されたため，非常に重いアプリケーションサーバーになってしまっていました。また，前クラウド自体の設計が各所に残っており，仮想化環境などで利用しやすいとは言えない性質もたくさん持っていました。

IBMは，クラウドネイティブ時代に対応するため，アプリケーションサーバーのカーネルから再設計し，2012年から新しいランタイムとしてWebSphere Libertyの提供を開始しました。WebSphere Libertyでは従来型のWASの欠点の大部分が改善されています。このカーネル上に，従来のWASで提供されてきた機能をモジュールとして移植し，また新しく登場した各種仕様やソフトウェアに対応したのがWebSphere Libertyです。

2017年にWebSphere Libertyはオープンソース化され，Open Libertyとして公開されました。

### Open LibertyとWebSphere Liberty

現在は，基本的にOpen Libertyで新機能の開発が行われ，それを取り込む形で製品版のWebSphere Libertyが提供されています。製品版で見つかったバグの修正も，Open Libertyのソースが管理されているGitHub上でissueが作成されて行われます。

オープンソースをベースとしたソフトウェア製品は多数ありますが，Libertyの大きな特徴は，製品版のWebSphere LibertyとOSS版のOpen Libertyのバージョンが完全に同期されていることです。つまり，同じバージョン番号が同じタイミングで公開されます。Open Libertyで追加された新機能は，同じタイミングででた同バージョンのWebSphere Libertyでもすぐに利用できます。

原則としてOpen Libertyでのみ提供されている機能はないので，Open Libertyで実行していた構成やアプリケーションは，そのまま同じバージョンのWebSphere Libertyで同じように動作します。

製品版のWebSphere Libertyでのみ提供されている機能としては，以下のようなものがあります。Java EE/Jakarta EEやMicroProfileなど，標準機能のAPIなどはほとんどOpen Libertyでもそのまま提供されています。

- OSS化されるまえに提供されていたJava EE 6 Web ProfileのAPI
- WebSphere LibertyのNetwork Deploymentエディションで提供されているクラスタリング・統合管理機能（Collective機能）
- WebSphere LibertyのzOS版で提供されている，zOSの機能と連携する機能
- 過去にIBMが独自に提供していたCommonJ互換のHeritage API
- WebRTCクライアントとの連携機能，JSR309 Media Server Control，API Discoveryなど安定化された機能

このガイドブックでは，Open LibertyとWebSphere Libertyに共通の内容は「Liberty」という表記で記載しています。どちらかに固有の内容については，Open LibertyもしくはWebSphere Libertyと明記しています。

{% note %}

Libertyのバージョンは4桁で表現されます。1桁目は西暦の下二桁，2/3桁目は0，4桁目はその年にでた通番です。Libertyは4週間ごとに新しいバージョンが出るので，年に12〜13のバージョンが公開されます。通番はおおよそ公開された月と同じになります。

たとえば，2023年9月に公開されたLibertyのバージョンは，23.0.0.9になります。

Libertyでは，一桁目のバージョンが上がっても「メジャーバージョンアップ」ではありません。単に公開された年が変わっただけです。後述しますが，Libertyでは破壊的な変更をともなうバージョンアップはほとんど行われません。

{% endnote %}

### Libertyの特徴：完全にモジュール化されたランタイム

Libertyは内部が完全にモジュール化されており，使用する機能だけを有効にすることができます。

アプリケーションから利用できるAPIや，サーバーが提供する機能は全てFeatureというモジュールで提供されています。APIは，Java EE/Jakarta EEというような大きなくくりではなく，Servlet/JSP/JAX-RS/JSON Binding/JSON Processingというような個々のAPIの粒度でモジュール化されています。

必要なFeatureだけを構成し，起動時にメモリに読み込み初期化することで，Libertyはランタイムの使用メモリや起動時間を最低限にすることができています。また，実際に利用するFeatureの実行に必要なファイルだけをディスク上に導入することもでき，ランタイムのサイズも最小限になります。

また，Featureによって新機能の追加もやりやすくなっています。Libertyにさまざまな機能，たとえば認証を提供する各種プロバイダーの対応機能などを実装しても，そのFeatureを有効にしなければ，既存の環境が重くなることもありません。Libertyでは既存環境へリスクをあたえることなく，自由に新機能の追加ができます。

Open Libertyでは，2023年10月現在，260ものFeatureが提供されています（version 23.0.0.10）。

### Libertyの特徴：ゼロマイグレーション・ポリシー

ソフトウェアは，バグの修正やセキュリティ脆弱性対応のため定期的なバージョンアップが必要です。しかし，一般にアプリケーションサーバーのバージョンを更新して新仕様に対応したランタイムに変更すると，アプリケーションの更新作業，マイグレーションが必要となってしまいます。これは大きな負担となります。ですが，Libertyにおいてはバージョンアップにともなうアプリケーションや構成のマイグレーションは，原則として必要なくなります。

Libertyが提供するFeatureは，APIの種類だけでなく，仕様のバージョンも含んだ名前になっています。そして，新しいバージョンのAPI仕様に対応したFeatureが公開された後も，既存のFeatureの提供は続きます。そのため，Libertyのバージョンが更新され，新しい仕様に対応しても，サーバーの構成を変更しなければ，既存のFeatureがそのまま利用でき，既存のアプリケーションは更新することなく，そのまま利用することができます。

たとえば，Open LibertyではServlet仕様のAPIを提供するFeatureとして，2023年10月時点で以下のものが提供されています（WebSphere Libertyではservlet-3.0も提供されています）。

- servlet-3.1
- servlet-4.0
- servlet-5.0
- servlet-6.0

構成ファイルでのservlet-3.1のFeatureを指定すれば，最新のバージョンでもServlet 3.1仕様に準拠して実装したアプリケーションがそのまま稼働します。

Java EE 7/8からJakarta EE 9.1/10に移行するには，アプリケーションが参照するAPIの名前空間（パッケージ名）を`javax`から`jakarta`に変更することが必要です。アプリケーションによっては，利用しているライブラリの制限から容易に名前空間を変更することができないものもあるでしょう。ですがLibertyであれば，当分の間Java EEで実装されたアプリケーションも利用し続けることができます。

ゼロマイグレーション・ポリシーの例外はJava SE仕様への対応です。Libertyでは新しいJava SE仕様への対応を行うと共に，古いJava SE仕様のサポートを終了することがあります。たとえば，Java 6対応は2017年のversion 17.0.0.3で，Java 7対応は2019年のversion 19.0.0.9で終了しています。Java 8対応の終了は，2023年10月現在では，2026年を予定しています。

使用するJRE/JREのバージョンを上げたときには，Java SE使用の非互換性により，従来利用していたアプリケーションがそのままでは利用できない事があります。

{% note %}

Open LibertyがサポートするJava SEのバージョンと，サポートする期間についての最新情報は，以下のページを参照してください。

https://openliberty.io/docs/latest/java-se.html

{% endnote %}

また，バージョンアップによって仕様のバージョンは上がらなくても，バグは適宜修正されています。アプリケーションによっては，修正以前の誤った動作に依存してしまっているケースもしばしばあり，バージョンアップにあたって修正が必要となるケースも稀にあります。移行前のテストは行ってください。

### Libertyの特徴：ビジネスにも使いやすいEPL

### Libertyの特徴：ツールとの親和性の高さ

### Libertyの特徴：軽量，高速なランタイム


